"!{float:right}https://secure.travis-ci.org/floere/phony.png!":http://travis-ci.org/floere/phony
"!https://codeclimate.com/github/floere/phony.png!":https://codeclimate.com/github/floere/phony

h1. Phony

The (admittedly crazy) goal of this Gem is to be able to format/split all phone numbers in the world.

Used in: "airbnb.com":http://airbnb.com, "restorm.com":http://restorm.com, "socialcam.com":http://socialcam.com, "zendesk.com":http://www.zendesk.com/ (and many, many others).

There's also a Rails wrapper: https://github.com/joost/phony_rails.

h2. Description

This gem normalizes, formats and splits *E164 phone numbers*. A valid E164 phone number *must* include a country code.

E164 numbers are international numbers with a country dial prefix, usually an area code and a subscriber number. For example, the Austalian number number @+61 412 345 678@ can be broken down into the following components:
* a country code of @61@
* a mobile number denoted by the @4@ (specific to Australia)
* a subscriber number of @12 345 678@

Learn more about E164 numbers "here":http://en.wikipedia.org/wiki/E.164.

Currently handles Abhas, Afghan, Algerian, Argentinan, Austrian, Australian, Azerbaijani, Belgian, Brazilian, Cambodian, Chilean, Chinese, Croatian, Cuban, Cypriot, Czech, Danish, Dutch, Egyptian, El Salvadorian, Estonian, French, German, Ghanan, Gibraltar, Greek, Haiti, Hong Kong, Hungarian, Indian, Iran, Irish, Israel, Italian, Kazakh, Lithuanian, Luxembourgian, Malaysian, Malta, Mexican, Monaco, Morocco, New Zealand, Nigerian, Norwegian, Peruvian, Polish, Romanian, Russian, Rwandan, Seychelles, Singapore, Slovakian, South African, South Korean, South Osetian, Spanish, Sri Lankan, Sudan, Swedish, Swiss, Thailand, Tunisian, Turkish, Liechtenstein, UK, US, Venezuelan, and Vietnamese numbers.

And to some extent, all others. Just try if it works for you.

If it doesn't, please "enter an issue":http://github.com/floere/phony/issues.

h2. Installation

Using with Rails? Check out: https://github.com/joost/phony_rails.

With Bundler:
Append @gem 'phony')@ to your @Gemfile@ and @bundle install@ it.

Without Bundler:
Run @gem install phony@ from your command line.

h2(#usage). Usage

h3(#plausibility). Plausibility

"Plausible" means "seems reasonable or probable", not implying 100% correctness on a @true@, but implying 100% correctness on a @false@ return value. So if this returns @true@, it might still be not a plausible number. If it returns @false@, it is definitely not an E164 conform number.

Use this method in combination with @normalize@ for saving it into the database. Also see https://github.com/floere/phony/issues/35 for a discussion on the topic.

Note that you can add constraints to the plausibility check like the country code, @cc@, and the national destination code, @ndc@. Use the options to further limit the plausibility range. For example, only allow a small number of countries.

@expect(Phony.plausible?('0000000')).to be false@

@expect(Phony.plausible?('hello')).to be false@

@expect(Phony.plausible?('+41 44 111 22 33')).to be true@

@expect(Phony.plausible?('+41 44 111 22 33', cc: '41')).to be true@

@expect(Phony.plausible?('+41 44 111 22 33', ndc: '44')).to be true@

@expect(Phony.plausible?('+41 44 111 22 33', cc: '1')).to be false@

@expect(Phony.plausible?('+41 44 111 22 33', ndc: '43')).to be false@

@expect(Phony.plausible?('+41 44 111 22 33', cc: '41', ndc: '44')).to be true@

@expect(Phony.plausible?('+41 44 111 22 33', cc: /4(0|2)/, ndc: /4(4|5)/)).to be false@

@expect(Phony.plausible?('+41 44 111 22 33', cc: /4(0|1)/, ndc: /4(4|5)/)).to be true@

h3(#normalizing). Normalizing

This will often raise an error if you try normalizing a non E164-izable number (a number that does not contain enough information to be normalized into an E164 conform number). Use @Phony.plausible?@ for checking if it can be normalized first.

@expect(Phony.normalize('41443643533')).to eq('41443643533')@

@expect(Phony.normalize('+41 44 364 35 33')).to eq('41443643533')@

@expect(Phony.normalize('+41 44 364 35 33')).to eq('41443643533')@

@expect(Phony.normalize('+41 800 11 22 33')).to eq('41800112233')@

@expect(Phony.normalize('John: +41 44 364 35 33')).to eq('41443643533')@

@expect(Phony.normalize('1 (703) 451-5115')).to eq('17034515115')@

@expect(Phony.normalize('1-888-407-4747')).to eq('18884074747')@

@expect(Phony.normalize('1.906.387.1698')).to eq('19063871698')@

@expect(Phony.normalize('+41 (044) 364 35 33')).to eq('41443643533')@

h3(#formatting). Formatting

@expect(Phony.formatted('41443643532')).to eq('+41 44 364 35 32')@

@expect(Phony.formatted('41800112233')).to eq('+41 800 11 22 33')@

@expect(Phony.formatted('43198110')).to eq('+43 1 98110')@

@expect(Phony.formatted('18705551122')).to eq('+1 870 555 1122')@

h4(#international). International

@expect(Phony.formatted('18091231234', :format => :international)).to eq('+1 809 123 1234')@

@expect(Phony.formatted('43198110', :format => :international)).to eq('+43 1 98110')@

@expect(Phony.formatted('43198110', :format => :international_absolute)).to eq('+43 1 98110')@

@expect(Phony.formatted('33142278186', :format => :+)).to eq('+33 1 42 27 81 86')@

@expect(Phony.formatted('43198110', :format => :international_relative)).to eq('0043 1 98110')@

@expect(Phony.formatted('4233841148', :format => :international_relative)).to eq('00423 384 11 48')@

h4(#spaces). With spaces

@expect(Phony.formatted('18091231234', :format => :international, :spaces => '')).to eq('+18091231234')@

@expect(Phony.formatted('43198110', :format => :international, :spaces => '')).to eq('+43198110')@

@expect(Phony.formatted('43198110', :format => :international_absolute, :spaces => '')).to eq('+43198110')@

@expect(Phony.formatted('33142278186', :format => :+, :spaces => '')).to eq('+33142278186')@

@expect(Phony.formatted('43198110', :format => :international_relative, :spaces => '')).to eq('0043198110')@

@expect(Phony.formatted('4233841148', :format => :international_relative, :spaces => '')).to eq('004233841148')@

h4(#special). With special spaces

@expect(Phony.formatted('18091231234', :format => :international, :spaces => :-)).to eq('+1-809-123-1234')@

@expect(Phony.formatted('43198110', :format => :international, :spaces => :-)).to eq('+43-1-98110')@

@expect(Phony.formatted('43198110', :format => :international_absolute, :spaces => :-)).to eq('+43-1-98110')@

@expect(Phony.formatted('33142278186', :format => :+, :spaces => :-)).to eq('+33-1-42-27-81-86')@

@expect(Phony.formatted('43198110', :format => :international_relative, :spaces => :-)).to eq('0043-1-98110')@

@expect(Phony.formatted('4233841148', :format => :international_relative, :spaces => :-)).to eq('00423-384-11-48')@

h4(#national). National

@expect(Phony.formatted('41443643532', :format => :national)).to eq('044 364 35 32')@

@expect(Phony.formatted('41800112233', :format => :national)).to eq('0800 11 22 33')@

@expect(Phony.formatted('43198110', :format => :national)).to eq('01 98110')@

h4(#local). Local

@expect(Phony.formatted('41443643532', :format => :local)).to eq('364 35 32')@

@expect(Phony.formatted('493038625454', :format => :local)).to eq('386 25454')@

h3(#splitting). Splitting

@expect(Phony.split('43198110')).to eq(['43', '1', '98110'])@

@expect(Phony.split('33112345678')).to eq(['33', '1', '12','34','56','78'])@

@expect(Phony.split('4976112345')).to eq(['49', '761', '123', '45'])@

@expect(Phony.split('3928061371')).to eq(['39', '2', '806', '1371'])@

@expect(Phony.split('41443643532')).to eq(['41', '44', '364', '35', '32'])@

@expect(Phony.split('15551115511')).to eq(['1', '555', '111', '5511'])@

@expect(Phony.split('6491234567')).to eq(['64', '9', '123', '4567'])@

@expect(Phony.split('41800334455')).to eq(['41', '800', '33', '44', '55'])@

Note: There is also a ! version of each of these methods which
      will destroy the original string and return a new (or old) one.
      Just work only with the returned value, and you will be fine.
