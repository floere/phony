require 'spec_helper'

describe Phony::CountryCodes, '#country' do
  subject { Phony::CountryCodes.instance }
  
  # Test data - in format [ Alpha2, Number ]
  TEST_DATA = {
    GE: [ '+995 442 123456' ],
    RU: [ '+7 840 123-45-67','+7 940 555 555' ],
    AF: [ '+93 30 539-0605','+93 700 202 496' ],
    AU: [ '+61 2 1255-3456','+61 432 555 555' ],
    CN: [ '+86 20 1255-3456','+86 131 5558 5558' ],
    DE: [ '+49 351 125-3456','+49 151 123 456' ],
    ID: [ '+62 21 6539-0605','+62 834 202 4961' ],
    IR: [ '+98 515 539-0605','+98 934 202 4961' ],
    NZ: [ '+64 3 539-0605','+64 21 202 4961' ],
    PH: [ '+63 35 539-0605','+63 996 202 4961' ],
    SG: [ '+65 6396 0605' ],
    TH: [ '+66 2 123 4567','+66 43 123456' ],
    GB: [ '+44 20 3344-5566','+44 141 222-3344','+44 70 0596 3437' ],
    VN: [ '+84 35 539-0605','+84 996 202 4961' ],

    # NANP tets
    CA: [ '+1 709 239-5000' ],
    TT: [ '+1 868-662-7272' ],
    VI: [ '+1 340-713-9645' ],
    US: [ '+1 212 555-3456','+1 800 234 5678','+1 678 555 5555' ]
  }
  
  MORE_TEST_DATA = {
    AC: ["2473551"],
    AF: ["93201234567"],
    DZ: ["213211231234", "213331231234"],
    AR: ["541112345678", "542911234567", "542965123456", "5491112345678", "5492201234567", "5492221123456", "548001234567"],
    AT: ["43198110", "4366914093902", "433161234567891", "432164123456789"],
    AU: ["61512341234", "61423123123"],
    BH: ["97312345678"],
    BD: ["88021234567", "8805112345", "88031123456", "88032112345", "8804311234567", "880902012345"],
    BY: ["375152123456", "375151512345", "375163423456", "375163112345", "375291234567", "375800123", "3758001234", "3758001234567", "37582012345678"],
    BE: ["3235551212", "32505551212", "3225551212", "3295551914", "3245551414", "3216473200", "32475279584", "3270123123"],
    BZ: ["5012051234"],
    BJ: ["22912345678"],
    BO: ["59122772266"],
    BW: ["26780123456", "2672956789", "2674634567", "2675812345", "26776712345", "26781234567"],
    BR: ["551112341234", "5511981231234"],
    KH: ["85512236142", "855977100872", "855234601183", "85533123456"],
    CL: ["5621234567", "5675123456", "56912345678", "56137123456"],
    CN: ["862112345678", "8675582193447"],
    CO: ["5711234567", "573101234567"],
    HR: ["385112312345", "385491231234"],
    CU: ["5351231234", "5371234567", "5342123456"],
    CY: ["35712322123456", "35722123456", "35791123456"],
    DK: ["4532121212"],
    EG: ["20212345678", "20921234567", "20951234567"],
    GQ: ["240222201123", "240335201123"],
    EE: ["3723212345", "37251231234", "3728001234", "37281231234", "37282231234", "37283212345", "37270121234"],
    FI: ["3589123123", "3581912312", "3585012312", "358600123"],
    FR: ["33112345678", "33812345678"],
    GE: ["99522012345", "995321234567", "995342123456", "995596123456"],
    DE: ["493038625454", "4932221764542", "4922137683323", "497614767676", "4921535100", "493434144602", "491805878323", "491815878323", "4915112312345", "49152112312345", "4916312312345"],
    GH: ["233302123456"],
    GI: ["35020012345", "35021112345", "35022212345", "35054123456", "35056123456", "35057123456", "35058123456", "35060123456", "3508012"],
    GR: ["302142345678", "302442345678", "305034571234", "306901234567", "307001234567", "308001001234", "308011001234", "308071001234", "308961001234", "309011234565", "309091234565"],
    HT: ["50922121234"],
    HK: ["85212341234"],
    HU: ["3612345678", "3622123456"],
    IS: ["354112", "3544211234", "3544621234", "3545511234"],
    ID: ["6242323032", "6285220119289", "62217815263", "6213123", "6213123456", "6217412", "6217412345", "6217712", "6217712123456", "62178123", "6217812345", "622112345", "622112345567", "622212345", "62221234567", "624311234", "62431123456", "6262212345", "62622123456", "6270123456", "6271123456", "62711234567", "62810123456", "6281012345678", "62820123456", "6287012345", "62877123456", "62881123456", "6288112345656", "6291234567", "629123456789"],
    IN: ["919911182111", "912212345678", "911411234567", "913525123456"],
    IR: ["982112341234", "989191231234"],
    IE: ["35311234567", "3532212345", "35345123456", "353801234567", "353761234567", "353800123456", "353000123456"],
    IL: ["972100", "97221231234", "97282411234", "97291231234", "972501231234", "972591231234", "972771231234", "9721700123123", "97021231234", "97082411234", "97091231234", "970501231234", "970591231234", "970771231234", "9701700123123"],
    IT: ["3934869528", "393357210488", "390612341234", "390288838883", "390141595661", "3903123391", "390909709511"],
    JP: ["81312345678", "81120123456", "81111234567", "81123123456", "81126712345", "819012345678"],
    KE: ["254201234567", "254111234567", "254723100220"],
    KG: ["996312212345", "996315212345", "996313121234", "996394621234", "996501234567", "996521234567", "996581234567", "996800123456"],
    LT: ["37070012123", "37061212123", "37051231212", "37037121212", "37044011212"],
    LU: ["352222809", "35226222809", "352621123456", "3524123456", "352602112345678", "352370431", "35227855"],
    MY: ["6082123456", "60312345678", "60212345678", "60111231234", "60800121234"],
    MT: ["35621231234", "35677123456", "35698123456", "35651231234"],
    MX: ["525512121212", "526641231212"],
    MC: ["37741123456", "377612345678"],
    ME: ["38280123456", "3822012345", "38220123456", "38232123456", "38278103456", "38263123", "382631234567890", "38277103456", "38294103456", "38288103456", "3826812", "382681212345678", "38270123", "382701234567890"],
    MA: ["212537718685", "212612345678"],
    NL: ["31612345678", "31201234567", "31222123456"],
    NO: ["4721234567", "4731234567", "4741234567", "4751234567", "4761234567", "4771234567", "4781234567", "4791234567"],
    OM: ["96824423123", "96825423123"],
    PK: ["922112345678", "92221234567", "92232123456", "923012345678"],
    PY: ["59521123456", "595211234567", "595345123456", "595961611234"],
    PE: ["51112341234", "51912341234", "51841234123"],
    PH: ["6321234567", "6321234567890", "632123456789012", "639121234567", "63881234567"],
    PL: ["48123456789", "48501123456", "48800123456", "48801123456", "48701123456"],
    PT: ["351211231234", "351241123123", "351931231234"],
    QA: ["9741245123456", "9742613456", "97433123456", "97444412456", "9748001234", "9749001234", "97492123", "97497123"],
    RO: ["40211231234", "40721231234", "40249123123"],
    RU: ["78122345678", "74012771077", "78402411212", "7840121212", "7799121212", "7995344121212", "7209175276"],
    RW: ["250781234567", "250721234567", "250731234567", "250251234567", "25006123456"],
    ST: ["2392220012", "2399920012"],
    KR: ["82212345678", "825112345678", "821027975588", "821087971234"],
    SS: ["211123212345", "211973212345"],
    SD: ["249187171100"],
    TH: ["6621231234663612312366851234567"],
    TN: ["21611231234", "21621231234"],
    SV: ["50321121234", "50361121234"],
    SG: ["6561231234"],
    SK: ["421912123456", "421212345678", "421371234567"],
    LK: ["94711231212"],
    SE: ["46812345678", "46111234567", "46721234567", "46125123456"],
    CH: ["41443643532", "41800334455"],
    TZ: ["255221231234", "255651231234", "255861123123"],
    TR: ["903121234567"],
    UG: ["256414123456", "256464441234"],
    GB: ["442075671113", "442920229901", "441134770011", "441412770022", "441204500532", "44120462532", "441382229845", "441539248756", "441539648788", "441697222555", "441697388555", "44169772333", "441697744888", "441946555777", "44194662888", "441946722444", "443005878323", "443457777334", "44500557788", "445575671113", "445644775533", "447020229901", "447780605207", "447480605207", "44800557788", "448084682355", "448005878323"],
    US: ["15551115511"],
    VE: ["582121234567"],
    VN: ["8498123456", "8499612345", "8441234567"],
    ZM: ["260977640895", "260211229049"],
    NZ: ["6491234567"],
    BT: ["9759723642"],
    BN: ["6737932744"],
    BF: ["22667839323"],
    BI: ["25712345678"],
    CM: ["23727659381"],
    CV: ["2385494177"],
    CF: ["23612345678"],
    TD: ["23512345678"],
    KM: ["2693901234", "2693401234"],
    CG: ["242123456789"],
    CK: ["68251475"],
    CR: ["50622345678"],
    CI: ["22537335518"],
    TL: ["6701742945"],
    CD: ["24311995381"],
    DG: ["2461234683"],
    DJ: ["25349828978"],
    EC: ["593445876756"],
    ER: ["2916537192"],
    ET: ["251721233486"],
    FK: ["50014963"],
    FO: ["298997986"],
    FJ: ["6798668123"],
    GF: ["594594123456"],
    PF: ["689219889"],
    GA: ["2411834375"],
    GM: ["2206683355"],
    GL: ["299314185", "299691123"],
    GP: ["590123456789"],
    GT: ["50219123456789", "50221234567"],
    GN: ["22412345678"],
    GW: ["2453837652"],
    GY: ["5922631234"],
    HN: ["50412961637"],
    IQ: ["96411234567", "96421113456", "9647112345678"],
    JO: ["96280012345", "96226201234", "962712345678", "962746612345", "96290012345", "96285123456", "96270123456", "96262501456", "96287901456"],
    KI: ["68634814"],
    KP: ["850212345", "8502123456789", "85023812356", "8501911234567"],
    KW: ["96523456789", "9651812345"],
    LA: ["85697831195"],
    LV: ["37180123456", "37163723456", "37129412345"],
    LB: ["9611123456", "9614123456", "9613123456", "96170123456", "96190123456", "96181123456"],
    LS: ["26623592495"],
    LR: ["23121234567", "2314123456"],
    LY: ["21820512345", "21822123456", "218211234456", "218911234456"],
    MG: ["26120012345678", "261201243456", "261512345678"],
    MW: ["2651725123", "265213456789", "2659123456", "265991123456"],
    MV: ["9606568279"],
    ML: ["22379249349"],
    MH: ["6924226536"],
    MQ: ["596596123456"],
    MR: ["22212345678"],
    MU: ["2309518919"],
    FM: ["6911991754"],
    MD: ["37380012345", "37322123345", "37324112345", "37360512345", "37380312345"],
    MN: ["9761112345", "9761211234", "97612112345", "97670123456", "97675123456", "97688123456", "97650123456"],
    MZ: ["258600123456", "25825112345", "258821234456", "258712344567"],
    NA: ["264675161324", "26467175890", "26463088612345", "264851234567"],
    NR: ["6741288739"],
    NP: ["97714345678", "97710123456", "9779812345678"],
    NC: ["687747184"],
    NI: ["50512345678"],
    NE: ["22712345678"],
    NU: ["6833651"],
    PW: ["6804873653"],
    PA: ["5078001234", "50761234567", "5072123456"],
    PG: ["6753123567", "6751801234", "67580123456", "67591123456", "6751612345", "67518412345678", "67517012", "6751891", "6752701234", "6752751234", "67527912", "67511512345678"],
    YT: ["2625943992657"],
    SH: ["2903614"],
    PM: ["508418826"],
    WS: ["685800123", "68561123", "6857212345", "685830123", "685601234", "6858412345"],
    SM: ["378800123", "3788001234567", "378012345", "3780123456789", "378512345", "3785123456789"],
    SA: ["96628528423"],
    SN: ["221123456789"],
    RS: ["38180012345", "3811012345", "38110123456", "38111123456", "381111234567", "381721234567", "38160123", "381601234567", "38142123456", "38191234567", "38160123", "381601234567890", "38170123456"],
    SL: ["23264629769"],
    SB: ["67754692", "6777546921"],
    SO: ["252103412345", "2521313123", "2521601234", "25250012345", "252671234567"],
    SR: ["597958434", "597212345", "5976123456"],
    SZ: ["26822071234", "2685501234"],
    SY: ["963111234567", "963311234567", "96315731234", "963912345678"],
    TW: ["88618123456", "8866121234567", "886212345678", "88631234567", "88633123456", "88682712345", "8864121234", "88690123456", "886901234567", "88694991345"],
    TG: ["22812345678"],
    TJ: ["992313012345", "992331700123", "992372123345", "992505123456", "992973123456", "992474456123"],
    TK: ["6901371"],
    TO: ["67620123", "67684123", "6767712345", "6768912345"],
    TV: ["68893741"],
    TM: ["99312456789", "99313145678", "99313924567", "99361234567"],
    UA: ["380800123456", "380312123456", "380320123456", "380325912345", "380326061234", "380981234567"],
    AE: ["97180012", "971800123456789", "97121234567", "971506412345", "971600641234", "971500641234", "971200641234"],
    UY: ["59880012345", "59820123456", "59821123456", "59890912345", "59893123456", "59890812345", "59880512345"],
    UZ: ["998433527869"],
    VU: ["67889683"],
    YE: ["9671234567", "96712345678", "9677234567", "967771234567", "967581234"],
    ZW: ["2632582123456", "2632582123", "263147123456", "263147123", "263270123456", "26327012345", "2638612354567"]
  }
  
  # Test a bogus phone number
  it 'ignores bogus phone numbers (single digit)' do
    subject.country( '5' ).should == nil
  end
  
  # Test another bogus phone number
  it 'ignores bogus phone numbers (text)' do
    subject.country( 'abc' ).should == nil
  end
  
  # Test all data given in the 'TEST' block above
  TEST_DATA.each do |alpha2, numbers|
    numbers.each do |number|
      it "recognises #{number} as #{alpha2.to_s}" do
        number = subject.normalize number
        subject.country(number).should == alpha2
      end
    end
  end
  
  # Test all data given in the 'MORE_TEST' block above
  MORE_TEST_DATA.each do |alpha2, numbers|
    numbers.each do |number|
      it "recognises #{number} as #{alpha2.to_s}" do
        number = subject.normalize number
        subject.country(number).should == alpha2
      end
    end
  end
  
  # Quick test to see which countries need further tests
  # Note that any countries flagged here have not been verified, and may yield incorrect data!
  ( Phony.recognized_countries - ( TEST_DATA.keys + MORE_TEST_DATA.keys ) ).each do |untested_alpha2|
    pending "Needs phone number samples for country #{untested_alpha2}."
  end
  
end
